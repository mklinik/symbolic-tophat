% !TEX root=../main.tex



\section{Properties}
\label{sec:properties}


\begin{lemma}[Not sat is safe to remove]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi $,
then $\neg\text{SAT }\phi$ implies that ???????
\label{lemma:notSat}
\end{lemma}

\fixme{We need to think a bit more about why it is allright to remove not-sat branches}

\begin{lemma}[Stuck really is stuck]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi$,
then $t=t'$ and $\phi=\phi'$ implies that there is no step $t',\sigma'\handle{i'} t'',\sigma'',\phi'$ such that either $t'\neq t''$ or $\phi\neq\phi'$.
\label{lemma:stuck}
\end{lemma}
\fixme{$\phi'$ is not in scope on the left side of the implication.}


The grammer of concrete inputs is as follows.

\usemacro{G-CInputs}


For completeness and soundness we define what it means to completely evaluate a task, given a list of concrete inputs.

\begin{function}
  \signature{eval :: \Task \times [\mathrm{Concrete inputs}] \times \mathrm{State} \rightarrow \Task \times \mathrm{State}} \\
  eval\ t\ (j:js)\ \sigma = \begin{array}{ll}
                              (t',\sigma')      & \Value(t',\sigma') \equiv v \\
                              eval\ t'\ \sigma' & \Value(t',\sigma') \equiv \bot
                                  \end{array}
                              with t,s\xrightarrow[]{j} t',\sigma'
\end{function}

\begin{theorem}[Soundness of symbolic execution]
\label{thm:sound}

For all tasks $t$, for all elements $(t',I,\sigma',\phi')\in drive\ t\ [\ ]\ \emptyset\ \True$,
it holds that there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$eval\ t\ I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]\ \emptyset=(t_n,\sigma_n)$ with $t_n=t'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ and $\sigma_n=\sigma'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ and $\phi[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]=\True$.
\end{theorem}


\begin{lemma}[Soundness of evaluation]
  $\forall e,\sigma \forall e,\sigma\eval v,\sigma',\phi$
  there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \bar{\eval}v',\sigma''$
  with $v[s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv v' \wedge \sigma' [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv \sigma'' \wedge \phi [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
\end{lemma}

\begin{proof}[sketch]
  We prove this Lemma by induction over $t$. Tis is trivial for all but one case.

  \case{$t=\If{e_1}{e_2}{e_3}$}
       {There are two rules that apply.\\
       \userule{Sym-E-IfTrue}\\
       In this case }
\end{proof}

\begin{lemma}[Soundness of striding]
  $\forall t,\sigma \forall t,\sigma\stride t',\sigma',\phi$
  there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \bar{\stride}t',\sigma''$
  with $t[s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv t' \wedge \sigma' [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv \sigma'' \wedge \phi [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
\end{lemma}

\begin{lemma}[Soundness of normalisation]
  $\forall e,\sigma \forall e,\sigma\normalise t,\sigma',\phi$
  there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $e,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \bar{\normalise}t',\sigma''$
  with $t[s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv t' \wedge \sigma' [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv \sigma'' \wedge \phi [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
\end{lemma}

\begin{lemma}[Soundness of handling]
  $\forall t,\sigma \forall t,\sigma\handle{i} t',\sigma',\phi$
  there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \xrightarrow[]{i} t'',\sigma''$
  with $t'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv t'' \wedge \sigma' [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv \sigma'' \wedge \phi [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
\end{lemma}


\begin{lemma}[Soundness of driving]
  $\forall t,\sigma \forall t,\sigma\drive{i} t',\sigma',\phi$
  there exists a mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \xRightarrow[]{i} t'',\sigma''$
  with $t'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv t'' \wedge \sigma' [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \equiv \sigma'' \wedge \phi [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
\end{lemma}


\begin{theorem}[Completeness of symbolic execution]
For all tasks $t$ and input lists $[j_0,\cdots,j_n]$ such that $eval\ t\ [j_0,\cdots,j_n]\ \emptyset = (t',\sigma')$,
then there exists an element $(t'',I,\sigma'',\phi'')\in drive\ t\ [\ ]\ \emptyset\ \True$ and mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]=[j_0,\cdots,j_n]$ and $t'=t''[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$.
  \label{thm:complete}
\end{theorem}
