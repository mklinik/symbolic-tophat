% !TEX root=../main.tex



\section{Properties}
\label{sec:properties}


\begin{lemma}[Not sat is safe to remove]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi $,
then $\neg\text{SAT }\phi$ implies that ???????
\label{lemma:notSat}
\end{lemma}

\fixme{We need to think a bit more about why it is allright to remove not-sat branches}

\begin{lemma}[Stuck really is stuck]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi$,
then $t=t'$ and $\phi=\phi'$ implies that there is no step $t',\sigma'\handle{i'} t'',\sigma'',\phi'$ such that either $t'\neq t''$ or $\phi\neq\phi'$.
\label{lemma:stuck}
\end{lemma}
\fixme{$\phi'$ is not in scope on the left side of the implication.}


The grammer of concrete inputs is as follows.

\usemacro{G-CInputs}


For completeness and soundness we define what it means to completely evaluate a task, given a list of concrete inputs.

\begin{function}
  \signature{\mathit{eval} :: \Task \times [\textrm{Concrete inputs}] \times \mathrm{State} \rightarrow \Task \times \mathrm{State}} \\
  \mathit{eval}\ t\ (j:js)\ \sigma = \begin{array}{ll}
                              (t',\sigma')      & \Value(t',\sigma') \equiv v \\
                              \mathit{eval}\ t'\ \sigma' & \Value(t',\sigma') \equiv \bot
                                  \end{array}
                              \textrm{with } t,s\xrightarrow[]{j} t',\sigma'
\end{function}

\begin{theorem}[Soundness of symbolic execution]
\label{thm:sound}

For all tasks $t$, for all elements $(t',I,\sigma,\phi)\in \mathit{drive}\ t\ [\ ]\ \emptyset\ \True$,
for all mappings $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$eval\ t\ I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]\ \emptyset=(t_n,\sigma_n)$ and $\phi[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]\equiv\True$,
it holds that $t_n=t'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ and $\sigma_n=\sigma[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$.
\end{theorem}


\begin{lemma}[Soundness of evaluation]
  \label{lem:soundeval}

  For all expressions $e$ and states $\sigma$,
  for all symbolic evaluations $e,\sigma\eval v,\sigma',\phi$,
  for all mapping $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma M \bar{\eval}v',\sigma''$ and $\phi M = \True$,
  we have $v\ M \equiv v' \wedge \sigma' M \equiv \sigma''$.

\end{lemma}

\begin{proof}
  We prove this Lemma by induction over $e$.

\case{$e=v$}
  {One rule applies, namely \userule{Sym-E-Value}.
  Since this rule does not generate constraints, any $M$ will do, as long as \userule{E-Value} with $\bar{\sigma}=\sigma M$. Since neither the state, nor the expression is altered by the evaluation, this case holds true trivially.}

\case{$e=\tuple{e_1,e_2}$}
  {One rule applies, namely \userule{Sym-E-Pair}.
  Provided that $\phi_1 M\wedge\phi_2 M$, and \userule{E-Pair} with $\bar{\sigma}=\sigma M$,
  we need to demonstrate that $\tuple{v_1,v_2} M \equiv \tuple{\bar{v_1},\bar{v_2}}$ and $\sigma'' M\equiv\bar{\sigma''}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 . \phi_1 M_1 \wedge e_1,\sigma M_1\bar{\eval}\bar{v_1},\bar{\sigma}\implies v_1 M_1\equiv \bar{v_1} \wedge \sigma' M_1\equiv\bar{\sigma}$ and
  $\forall M_2 . \phi_2 M_2 \wedge e_2,\sigma M_2\bar{\eval}\bar{v_1},\bar{\sigma}\implies v_2 M_2\equiv \bar{v_2} \wedge \sigma' M_2\equiv\bar{\sigma}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$, and we know from the premise that $e_1,\sigma M\bar{\eval}\bar{v_1},\bar{\sigma}$, and $e_2,\sigma' M\bar{\eval}\bar{v_2},\bar{\sigma}$ since $\sigma' M \equiv \bar{\sigma}$, we obtain that $v_1 M\equiv \bar{v_1}$ and $v_2 M\equiv \bar{v_2}$ and therefore $\tuple{v_1,v_2} M \equiv \tuple{\bar{v_1},\bar{v_2}}$.
  From the IH we directly obtain that $\sigma'' M\equiv\bar{\sigma}$.
  }

\case{$e=e_1 e_2$}
  {One rule applies, namely\\
  \userule{Sym-E-App}.
  Provided that $\phi_1 M\wedge\phi_2 M\wedge\phi_3 M$, and\\
  \userule{E-App} with $\bar{\sigma}=\sigma M$,
  we need to demonstrate that $v_1 M \equiv \bar{v_1}$ and $\sigma''' M\equiv\bar{\sigma'''}$.

  From the induction hypothesis, we obtain the following.
  $\forall M_1 . \phi_1 M_1 \wedge e_1,\sigma M_1\bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}
  \implies \lambda x : \tau.e_1' M_1\equiv \lambda x : \tau.\bar{e_1'} \wedge \sigma' M_1\equiv\bar{\sigma'}$
  and
  $\forall M_2 . \phi_2 M_2 \wedge e_2,\bar{\sigma'}\bar{\eval}\bar{v_2},\bar{\sigma''}
  \implies v_2 M_2\equiv \bar{v_2} \wedge \sigma'' M_2\equiv\bar{\sigma''}$
  and
  $\forall M_3 . \phi_3 M_3 \wedge \bar{e_1'}[x\mapsto \bar{v_2}],\bar{\sigma''}\bar{\eval}\bar{v_1},\bar{\sigma'''}
  \implies v_1 M_3\equiv \bar{v_1} \wedge \sigma''' M_3\equiv\bar{\sigma'''}$.

  Since $M$ satisfies both $\phi_1$, $\phi_2$ and $\phi_3$, and we know from the premise that $e_1,\sigma M\bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}$, $e_2,\sigma' M\bar{\eval}\bar{v_2},\bar{\sigma''}$ and $\bar{e_1'}[x\mapsto \bar{v_2}],\sigma'' M\bar{\eval}\bar{v_1},\bar{\sigma'''}$,
  since $\sigma' M\equiv\bar{\sigma'}$ and $\sigma'' M\equiv\bar{\sigma''}$.
  We can then directly conclude that $v_1 M \equiv \bar{v_1}$ and $\sigma''' M\equiv\bar{\sigma'''}$.}

\case{$e=\If{e_1}{e_2}{e_3}$}{}

\case{$e=\Ref e$}{}

\case{$e=!e$}{}

\case{$e=e_1:=e_2$}{}

\case{$e=\Edit e$}{}

\case{$e=\Enter \tau$}{}

\case{$e=\Update e$}{}

\case{$e=e_1\Then e_2$}{}

\case{$e=e_1\Next e_2$}{}

\case{$e=e_1\Or e_2$}{}

\case{$e=e_1\Xor e_2$}{}

\case{$e=\Fail$}{}
\end{proof}

\begin{lemma}[Soundness of striding]
  \label{lem:soundeval}

  For all tasks $t$ and states $\sigma$,
  for all symbolic evaluations $t,\sigma\stride t',\sigma',\phi$,
  for all mapping $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \bar{\stride}t'',\sigma''$ and $\phi M = \True$,
  we have $t'\ M \equiv t'' \wedge \sigma' M \equiv \sigma''$.

\end{lemma}

\begin{lemma}[Soundness of normalisation]
  \label{lem:soundnorm}

  For all expressions $e$ and states $\sigma$,
  for all symolic normalisations $e,\sigma\normalise t,\sigma',\phi$,
  for all mappings $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $e,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \bar{\normalise}t',\sigma''$ and $\phi M =\True$ and $\phi M = \True$,
  we have $t M \equiv t' \wedge \sigma' M \equiv \sigma''$.

\end{lemma}

\begin{lemma}[Soundness of handling]
  \label{lem:soundhandle}

  For all tasks $t$ and states $\sigma$,
  for all symbolic executions $t,\sigma\handle{i} t',\sigma',\phi$,
  for all mappings $M = [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma [s_0\mapsto c_0,\cdots,s_n\mapsto c_n] \xrightarrow[]{j} t'',\sigma''$ and $\phi M = \True$,
  we have $t'M \equiv t'' \wedge \sigma' M \equiv \sigma''$
\end{lemma}


\begin{lemma}[Soundness of driving]
  \label{lem:sounddrive}

  For all tasks $t$ and states $\sigma$,
  for all symbolic executions $t,\sigma\drive{i} t',\sigma',\phi$
  for all mappings $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma M \xRightarrow[]{i} t'',\sigma''$ and $\phi M = \True$,
  we have $t'M \equiv t'' \wedge \sigma' M \equiv \sigma''$.
\end{lemma}


\begin{theorem}[Completeness of symbolic execution]
For all tasks $t$ and input lists $[j_0,\cdots,j_n]$ such that $\mathit{eval}\ t\ [j_0,\cdots,j_n]\ \emptyset = (t',\sigma')$,
then there exists an element $(t'',I,\sigma'',\phi'')\in \mathit{drive}\ t\ [\ ]\ \emptyset\ \True$ and mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]=[j_0,\cdots,j_n]$ and $t'=t''[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$.
  \label{thm:complete}
\end{theorem}


\begin{lemma}[Completeness of evaluation]
  $\forall e,\sigma$ such that $t,\sigma \bar{\eval}v,\sigma'$
  there exists a symbolic execution $t,\sigma''\eval v',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\eval v,\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of striding]
  $\forall t,\sigma$ such that $t,\sigma \bar{\stride}t',\sigma'$
  there exists a symbolic execution $t,\sigma''\eval t'',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\stride t',\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of normalisation]
  $\forall e,\sigma$ such that $e,\sigma \bar{\normalise}t',\sigma'$
  there exists a symbolic execution $t,\sigma''\normalise t'',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\normalise t',\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of handling]
  $\forall t,\sigma,j$ such that $t,\sigma \xrightarrow[]{j} t'',\sigma''$
  there exists an $i$ such that $t,\sigma''\handle{i} t'',\sigma''',\phi$. And when substituting the symbol from $i$ with the concrete value from $j$, denoted by $s\mapsto c$, we get $\phi[s\mapsto c]\equiv\True$, $t''[s\mapsto c]\equiv t']$ and $\sigma'''[s\mapsto c]\equiv\sigma'']$.
\end{lemma}

\begin{lemma}[Completeness of driving]
\end{lemma}
