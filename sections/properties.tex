% !TEX root=../main.tex



\section{Properties}
\label{sec:properties}


\begin{lemma}[Not sat is safe to remove]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi $,
then $\neg\text{SAT }\phi$ implies that ???????
\label{lemma:notSat}
\end{lemma}

\fixme{We need to think a bit more about why it is allright to remove not-sat branches}

Although the task language does not contain explicit loops, we still have infinite symbolic execution paths. Observe the following small program. $\Edit 1 \Next \lambda x . \Edit x + 1$.

When we apply one symbolic execution step, we obtain $[(\Edit s_0\Next \lambda x. \Edit x+1,[s_0],\emptyset,\True),(\Edit 2,[\Continue],\emptyset,\True)]$.
Applying it a second time results in
$[(\Edit s_1\Next \lambda x. \Edit x+1,[s_0,s_1],\emptyset,\True)
 ,(\Edit s_0+1,[s_0,\Continue],\emptyset,\True)
 ,(\Edit 2,[\Continue],\emptyset,\True)]$.

 Applyting it a third time gives us
 $[(\Edit s_2\Next \lambda x. \Edit x+1,[s_0,s_1,s_2],\emptyset,\True)
  ,(\Edit s_0+1,[s_0,\Continue],\emptyset,\True)
  ,(\Edit 2,[\Continue],\emptyset,\True)]$.

It is evident that the first element will just continue to grow infinitely, since the left hand side can be updated infinitely many often. At the same time, no extra information is gained, $s_0$ and $s_1$ are erased from the program, and are not contained in the state or
predicate.


\fixme{this example demonstrates that $t=t'$ is NOT an indication of a stuck expansion, since a new symbol can be introduced each time.}


$\Update l \And (\Edit 0 \Then \lambda x . \If{!l\equiv x}{\Edit x}{\Fail})$\\
Let $s=[l\mapsto 5]$.\\

First step of symbolic execution:\\
$[(\Update l \And (\Edit 0 \Then \lambda x . \If{!l\equiv x}{\Edit x}{\Fail}),[\First s_0],[l\mapsto s_0],\True)]$\\

Second step of symbolic execution:\\
\begin{align*}
[(\Update l &\And& (\Edit 0 \Then \lambda x . \If{!l\equiv x}{\Edit x}{\Fail}),&[\First s_0,\First s_1],[l\mapsto s_1],\True)\\
,(\Update l &\And& \Edit s_1,&[\First s_0,\Second s_1],[l\mapsto s_0],s_1=s_0)\\
,(\Update l &\And& (\Edit s_1 \Then \lambda x . \If{!l\equiv x}{\Edit x}{\Fail}),&[\First s_0,\Second s_1],[l\mapsto s_0],s_1\neq s_0)]
\end{align*}

\begin{lemma}[Stuck really is stuck]
For all tasks $t$ and states $\sigma$ such that $t,\sigma \handle{i} t',\sigma',\phi$,
then $t=t'$ and $\phi=\phi'$ implies that there is no step $t',\sigma'\handle{i'} t'',\sigma'',\phi'$ such that either $t'\neq t''$ or $\phi\neq\phi'$.
\label{lemma:stuck}
\end{lemma}
\fixme{$\phi'$ is not in scope on the left side of the implication.}


The grammer of concrete inputs is as follows.

\usemacro{G-CInputs}


For completeness and soundness we define what it means to completely evaluate a task, given a list of concrete inputs.

\begin{function}
  \signature{\mathit{eval} :: \Task \times [\textrm{Concrete inputs}] \times \mathrm{State} \rightarrow \Task \times \mathrm{State}} \\
  \mathit{eval}\ t\ (j:js)\ \sigma = \begin{array}{ll}
                              (t',\sigma')      & \Value(t',\sigma') \equiv v \\
                              \mathit{eval}\ t'\ \sigma' & \Value(t',\sigma') \equiv \bot
                                  \end{array}
                              \textrm{with } t,s\xrightarrow[]{j} t',\sigma'
\end{function}

\begin{theorem}[Soundness of symbolic execution]
\label{thm:sound}

For all tasks $t$, for all elements $(t',I,\sigma,\phi)\in \mathit{drive}\ t\ [\ ]\ \emptyset\ \True$,
for all mappings $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$eval\ t\ I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]\ \emptyset=(t_n,\sigma_n)$ and $\phi[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]\equiv\True$,
it holds that $t_n=t'[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ and $\sigma_n=\sigma[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$.
\end{theorem}


\begin{lemma}[Soundness of evaluation]
  \label{lem:soundeval}

  For all expressions $e$ and states $\sigma$,
  for all symbolic evaluations $e,\sigma\eval v,\sigma',\phi$,
  for all mapping $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma M \bar{\eval}v',\sigma''$ and $\phi M = \True$,
  we have $v\ M \equiv v' \wedge \sigma' M \equiv \sigma''$.

\end{lemma}

\begin{proof}
  We prove this Lemma by induction over $e$.

\case{$e=v$}
  {One rule applies, namely \userule{Sym-E-Value}.
  Since this rule does not generate constraints, any $M$ will do, as long as \userule{E-Value} with $\bar{\sigma}=M \sigma$. Since neither the state, nor the expression is altered by the evaluation, this case holds true trivially.}

\case{$e=\tuple{e_1,e_2}$}
  {One rule applies, namely \userule{Sym-E-Pair}.
  Provided that $M\phi_1\wedge M\phi_2$, and \userule{E-Pair} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\tuple{v_1,v_2} \equiv \tuple{\bar{v_1},\bar{v_2}}$ and $M\sigma''\equiv\bar{\sigma''}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi_1 \wedge e_1, M_1\sigma \bar{\eval}\bar{v_1},\bar{\sigma}\implies  M_1v_1\equiv \bar{v_1} \wedge  M_1\sigma'\equiv\bar{\sigma}$ and
  $\forall M_2 . M_2\phi_2 \wedge e_2,M_2\sigma \bar{\eval}\bar{v_1},\bar{\sigma}\implies M_2v_2\equiv \bar{v_2} \wedge M_2\sigma'\equiv\bar{\sigma}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$,
  and we know from the premise that $e_1,M\sigma \bar{\eval}\bar{v_1},\bar{\sigma'}$,
  and $e_2,M\sigma'\bar{\eval}\bar{v_2},\bar{\sigma}$ since $M\sigma'\equiv \bar{\sigma'}$,
  we obtain that $M v_1\equiv \bar{v_1}$ and $M v_2 \equiv \bar{v_2}$ and therefore $M\tuple{v_1,v_2} \equiv \tuple{\bar{v_1},\bar{v_2}}$.
  From the IH we directly obtain that $M \sigma'' \equiv\bar{\sigma}$.
  }

\case{$e=e_1 e_2$}
  {One rule applies, namely\\
  \userule{Sym-E-App}.
  Provided that $M\phi_1 \land M\phi_2\land M\phi_3$, and\\
  \userule{E-App} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M v_1 \equiv \bar{v_1}$ and $M\sigma'''\equiv\bar{\sigma'''}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 . M_1\phi_1 \land e_1,M_1\sigma\bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}
  \implies M_1\lambda x : \tau.e_1' \equiv \lambda x : \tau.\bar{e_1'} \land M_1\sigma'\equiv\bar{\sigma'}$
  and\\
  $\forall M_2 . M_2\phi_2 \land e_2,\bar{\sigma'}\bar{\eval}\bar{v_2},\bar{\sigma''}
  \implies M_2 v_2 \equiv \bar{v_2} \land M_2\sigma'' \equiv\bar{\sigma''}$
  and\\
  $\forall M_3 . M_3\phi_3 \land \bar{e_1'}[x\mapsto \bar{v_2}],\bar{\sigma''}\bar{\eval}\bar{v_1},\bar{\sigma'''}
  \implies M_3 v_1\equiv \bar{v_1} \land M_3 \sigma'''\equiv\bar{\sigma'''}$.

  Since $M$ satisfies both $\phi_1$, $\phi_2$ and $\phi_3$, and we know from the premise that $e_1,\sigma M\bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}$, $e_2,\sigma' M\bar{\eval}\bar{v_2},\bar{\sigma''}$ and $\bar{e_1'}[x\mapsto \bar{v_2}],\sigma'' M\bar{\eval}\bar{v_1},\bar{\sigma'''}$,
  since $\sigma' M\equiv\bar{\sigma'}$ and $\sigma'' M\equiv\bar{\sigma''}$.
  We can then directly conclude that $v_1 M \equiv \bar{v_1}$ and $\sigma''' M\equiv\bar{\sigma'''}$.
  }

\case{$e=\If{e_1}{e_2}{e_3}$}
  {Two rules apply to this case.\\
  \case{\userule{Sym-E-IfTrue}}
    {Provided that $M\phi_1 \land M\phi_2 \land M v_1 M$, and\\
    \userule{E-IfTrue} with $\bar{\sigma}=M \sigma$,
    we need to demonstrate that $M v_2 \equiv \bar{v_2}$ and $M \sigma''\equiv\bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 .M_1 \phi_1 \land M_1 v_1 \land e_1,M_1 \sigma \bar{\eval}\True,\bar{\sigma}\implies M_1 v_1 \equiv \True \land M_1\sigma' \equiv\bar{\sigma}$ and\\
    $\forall M_2 . M_2 \phi_2 \wedge e_2,M_2 \sigma \bar{\eval}\bar{v_2},\bar{\sigma}\implies M_2 v_2\equiv \bar{v_2} \land M_2\sigma''\equiv\bar{\sigma''}$

    Since $M$ satisfies both $\phi_1$, $v_1$ and $\phi_2$,
    and we know from the premise that $e_1,M\sigma \bar{\eval}\True,\bar{\sigma}$,
    and $e_2,M\sigma' \bar{\eval}\bar{v_2},\bar{\sigma}$ since $M\sigma' \equiv \bar{\sigma}$,
    we obtain that $M v_2 \equiv \bar{v_2}$ and $M \sigma'' \equiv\bar{\sigma''}$.

    }
  \case{\userule{Sym-E-IfFalse}}
    {Provided that $M\phi_1 \land M\phi_2 \land \lnot M v_1 M$, and\\
    \userule{E-IfFalse} with $\bar{\sigma}=M \sigma$,
    we need to demonstrate that $M v_2 \equiv \bar{v_2}$ and $M \sigma''\equiv\bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 .M_1 \phi_1 \land\lnot M_1 v_1 \land e_1,M_1 \sigma \bar{\eval}\False,\bar{\sigma}\implies M_1 v_1 \equiv \False \land M_1\sigma' \equiv\bar{\sigma}$ and\\
    $\forall M_2 . M_2 \phi_2 \wedge e_3,M_2 \sigma \bar{\eval}\bar{v_3},\bar{\sigma}\implies M_2 v_3\equiv \bar{v_3} \land M_2\sigma''\equiv\bar{\sigma''}$

    Since $M$ satisfies both $\phi_1$, $\lnot v_1$ and $\phi_2$,
    and we know from the premise that $e_1,M\sigma \bar{\eval}\False,\bar{\sigma}$,
    and $e_3,M\sigma' \bar{\eval}\bar{v_3},\bar{\sigma'}$ since $M\sigma' \equiv \bar{\sigma'}$,
    we obtain that $M v_3 \equiv \bar{v_3}$ and $M \sigma'' \equiv\bar{\sigma''}$.

    }
  }

\case{$e=\Ref e$}
  {One rule applies, namely \userule{Sym-E-Ref}.
  Provided that $M\phi$, and \userule{E-Ref} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M l \equiv l$ and $M\sigma'[l\mapsto v]\equiv\bar{\sigma'}[l\mapsto\bar{v}]$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi \wedge e, M_1\sigma \bar{\eval}\bar{v},\bar{\sigma}\implies  M_1v\equiv \bar{v} \wedge  M_1\sigma'\equiv\bar{\sigma'}$.

  We assume that the assignment of location references happens in a deterministic manner, and that we can therefore conclude that exactly the same $l$ is used in both cases. Since $l$ cannot contain any symbols, $M l \equiv l$ holds trivially.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}\bar{v},\bar{\sigma'}$,
  we obtain that $M v\equiv \bar{v}$.
  This, together with $M \sigma' \equiv\bar{\sigma'}$ obtained from the induction hypothesis, we can conclude that $M\sigma'[l\mapsto v]\equiv\bar{\sigma'}[l\mapsto\bar{v}]$.
  }

\case{$e=!e$}
  {One rule applies, namely \userule{Sym-E-Deref}.
  Provided that $M\phi$, and \userule{E-Deref} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M \sigma'(l) \equiv \bar{\sigma'}(l)$ and $M\sigma'\equiv\bar{\sigma'}$.
  This is equivalent to demonstrating that $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.
  $\forall M_1 .  M_1\phi \wedge e, M_1\sigma \bar{\eval}l,\bar{\sigma}\implies  M_1l\equiv l \wedge  M_1\sigma'\equiv\bar{\sigma'}$.

  Note that since $l$ cannot contain any symbols, $M l \equiv l$ holds trivially.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  we immediately obtain $M\sigma'\equiv\bar{\sigma'}$.
}

\case{$e=e_1:=e_2$}
  {
  One rule applies, namely \userule{Sym-E-Assign}.
  Provided that $M\phi_1\wedge M\phi_2$, and \userule{E-Assign} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\unit \equiv \unit$, which holds true trivially,
  and $M\sigma''[l\mapsto v_2]\equiv\bar{\sigma''}[l\mapsto\bar{v_2}]$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi_1 \wedge e_1, M_1\sigma \bar{\eval}l,\bar{\sigma}\implies  M_1 l\equiv l \wedge  M_1\sigma'\equiv\bar{\sigma}$ and
  $\forall M_2 . M_2\phi_2 \wedge e_2,M_2\sigma \bar{\eval}\bar{v_2},\bar{\sigma'}\implies M_2v_2\equiv \bar{v_2} \wedge M_2\sigma'\equiv\bar{\sigma'}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$,
  and we know from the premise that $e_1,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  and $e_2,M\sigma'\bar{\eval}\bar{v_2},\bar{\sigma''}$ since $M\sigma'\equiv \bar{\sigma'}$,
  we obtain that $M l\equiv l$, $M v_2 \equiv \bar{v_2}$ and $M\sigma''\equiv\bar{\sigma''}$ and therefore $M\sigma''[l\mapsto v_2]\equiv\bar{\sigma''}[l\mapsto\bar{v_2}]$.
  }

\case{$e=\Edit e$}
  {One rule applies, namely \userule{Sym-E-Edit}.
  Provided that $M\phi$, and \userule{E-Edit} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M \Edit v \equiv \Edit \bar{v}$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi \land e, M_1\sigma \bar{\eval}\bar{v},\bar{\sigma'}\implies  M_1v\equiv \bar{v} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}\bar{v},\bar{\sigma'}$,
  we obtain that $M \Edit v\equiv \Edit \bar{v}$.
  We can furthermore directly conclude that $\sigma' M\equiv\bar{\sigma'}$.

  }

\case{$e=\Enter \tau$}
  {
  One rule applies, namely \userule{Sym-E-Enter}.
  Provided that $M\phi$, and \userule{E-Enter} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M \Enter \tau \equiv \Enter \tau$, which holds trivially since types do not hold symbols,
  and $M\sigma\equiv\bar{\sigma}$, which also hols trivially from the premise.
  }

\case{$e=\Update e$}
  {One rule applies, namely \userule{Sym-E-Update}.
  Provided that $M\phi$, and \userule{E-Update} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M \Update l \equiv \Update l$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi \land e, M_1\sigma \bar{\eval}l,\bar{\sigma'}\implies  M_1 l\equiv l \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  we obtain that $M \Update l\equiv \Update l$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Then e_2$}
  {One rule applies, namely \userule{Sym-E-Then}.
  Provided that $M\phi$, and \userule{E-Then} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t_1\Then e_2 \equiv \bar{t_1}\Then e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi \land e, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\implies  M_1 t_1\equiv \bar{t_1} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$,
  we obtain that $M t_1\Then e_2 \equiv \bar{t_1}\Then e_2$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Next e_2$}
  {One rule applies, namely \userule{Sym-E-Next}.
  Provided that $M\phi$, and \userule{E-Next} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t_1\Next e_2 \equiv \bar{t_1}\Then e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi \land e, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\implies  M_1 t_1\equiv \bar{t_1} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  and we know from the premise that $e,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$,
  we obtain that $M t_1\Next e_2 \equiv \bar{t_1}\Next e_2$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Or e_2$}
  {One rule applies, namely \userule{Sym-E-Or}.
  Provided that $M\phi_1\wedge M\phi_2$, and \userule{E-Or} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t_1\Or t_2 \equiv \bar{t_1}\Or\bar{t_2}$ and $M\sigma''\equiv\bar{\sigma''}$.

  From the induction hypothesis, we obtain the following. $\forall M_1 .  M_1\phi_1 \wedge e_1, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\implies  M_1 t_1\equiv \bar{t_1} \wedge  M_1\sigma'\equiv\bar{\sigma'}$ and
  $\forall M_2 . M_2\phi_2 \wedge e_2,M_2\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\implies M_2t_2\equiv \bar{t_2} \wedge M_2\sigma'\equiv\bar{\sigma'}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$,
  and we know from the premise that $e_1,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$,
  and $e_2,M\sigma'\bar{\eval}\bar{t_2},\bar{\sigma}$ since $M\sigma'\equiv \bar{\sigma'}$,
  we obtain that $M t_1\equiv \bar{t_1}$ and $M t_2 \equiv \bar{t_2}$ and therefore $M t_1\Or t_2 \equiv \bar{t_1}\Or\bar{t_2}$.
  From the IH we directly obtain that $M \sigma'' \equiv\bar{\sigma''}$.

  }

\case{$e=e_1\Xor e_2$}
  {  One rule applies, namely \userule{Sym-E-Xor}.
    Provided that $M\phi$, and \userule{E-Xor} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M e_1\Xor e_2 \equiv \bar{e_1}\Xor\bar{e_2}$,
    which holds trivially,
    and $M\sigma\equiv\bar{\sigma}$, which also holds trivially from the premise.

  }

\case{$e=\Fail$}
  {  One rule applies, namely \userule{Sym-E-Fail}.
    Provided that $M\phi$, and \userule{E-Fail} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M \Fail \equiv \Fail$, which holds trivially since fail do not hold symbols,
    and $M\sigma\equiv\bar{\sigma}$, which also hols trivially from the premise.

  }
\end{proof}

\begin{lemma}[Soundness of striding]
  \label{lem:soundstride}

  For all tasks $t$ and states $\sigma$,
  for all symbolic evaluations $t,\sigma\stride t',\sigma',\phi$,
  for all mapping $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,M\sigma \bar{\stride}\bar{t'},\bar{\sigma'}$ and $M \phi= \True$,
  we have $M t'\ \equiv \bar{t'} \land M\sigma' \equiv \bar{\sigma'}$.

\end{lemma}

\begin{proof}
  We prove Lemma~\ref{lem:soundstride} by induction over $t$.

\case{$t=t_1\Then e_2$}
  {
  Three rules apply.\\
  \case{\userule{Sym-S-ThenStay}}
    {Provided that $M\phi\equiv\True$ and \userule{S-ThenStay} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2 \land M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
    we know that $M t_1'\equiv\bar{t_1'}$,
    and therefore also $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2$,
    and from the induction hypothesis, we directly obtain  $M\sigma'\equiv \bar{\sigma'}$.
    }
  \case{\userule{Sym-S-ThenFail}}
    {Provided that $M\phi\equiv\True$ and \userule{S-ThenFail} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2 \land M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
    we know that $M t_1'\equiv\bar{t_1'}$,
    and therefore also $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2$,
    and from the induction hypothesis, we directly obtain  $M\sigma'\equiv \bar{\sigma'}$.
    }
  \case{\userule{Sym-S-ThenCont}}
    {Provided that $M\phi_1\land M\phi_2$ and \userule{S-ThenCont} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_2 \equiv \bar{t_2}\Then e_2 \land M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.\\
    From Lemma~\ref{lem:soundeval} we know that $\forall M_2 . M_2 \phi_2 \land e_2\bar{v_1}M_2\sigma'\bar{\eval}\bar{t_2},\bar{\sigma''}\implies M_2 t_2\equiv \bar{t_2}\land M_2\sigma''\equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $e_2\bar{v_1}M\sigma'\bar{\eval}\bar{t_2},\bar{\sigma''}$,
    we know that $M t_2\equiv\bar{t_2}$,
    and from the induction hypothesis, we directly obtain  $M\sigma''\equiv \bar{\sigma''}$.

    }
  }

\case{$t=t_1\Or t_2$}
  {
  Three rules apply.\\
  \case{\userule{Sym-S-OrLeft}}
    {Provided that $M\phi\equiv\True$ and \userule{S-OrLeft} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1'\equiv \bar{t_1'} \land M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
    we know that $M t_1'\equiv\bar{t_1'}$ and $M\sigma'\equiv \bar{\sigma'}$.

    }
  \case{\userule{Sym-S-OrRight}}
    {Provided that $M\phi\land M\phi$ and \userule{S-OrRight} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_2'\equiv \bar{t_2'} \land M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$. And \\
    $\forall M_2 . M_2 \phi \land t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\land M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
    we know that $M t_2'\equiv\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    }
  \case{\userule{Sym-S-OrNone}}
    {Provided that $M\phi_1\land M\phi_2$ and \userule{S-OrNone} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'} \land M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.
    $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$. And \\
    $\forall M_2 . M_2 \phi_2 \land t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\land M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
    we know that $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    }
  }

\case{$t=\Edit v$}
  {One rule applies, namely \userule{Sym-S-Edit}.
  Provided that $M\True$ and \userule{S-Edit} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\Edit v \equiv \Edit \bar{v}$ and $M\sigma \equiv \bar{\sigma}$.
  Both hold trivially.

  }

\case{$t=\Enter \tau$}
  {One rule applies, namely \userule{Sym-S-Fill}
  Provided that $M\True$ and \userule{S-Fill} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\Enter \tau \equiv \Enter \tau$ and $M\sigma \equiv \bar{\sigma}$.
  Both hold trivially.
  }

\case{$t=\Update l$}
  {One rule applies, namely \userule{Sym-S-Update}
  Provided that $M\True$ and \userule{S-Update} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\Update l \equiv \Update l$ and $M\sigma \equiv \bar{\sigma}$.
  Both hold trivially.
  }

\case{$t=\Fail$}
  {One rule applies, namely \userule{Sym-S-Fail}
  Provided that $M\True$ and \userule{S-Fail} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M\Fail \equiv \Fail$ and $M\sigma \equiv \bar{\sigma}$.
  Both hold trivially.
  }

\case{$t=e_1\Xor e_2$}
  {One rule applies, namely \userule{Sym-S-Xor}
  Provided that $M\True$ and \userule{S-Xor} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M e_1\Xor e_2 \equiv e_1\Xor e_2$ and $M\sigma \equiv \bar{\sigma}$.
  Both hold trivially.
  }

\case{$t=t_1\Next e_2$}
  {One rule applies, namely \userule{Sym-S-Next}
  Provided that $M\phi$ and \userule{S-Xor} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t_1'\Next e_2\equiv \bar{t_1'}\Next e_2$ and $M \sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.
  $\forall M_1 . M_1 \phi \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

  Since $M$ satisfies $\phi$, and $t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
  we directly obtain that $M t_1'\Next e_2\equiv \bar{t_1'}\Next e_2$ and $M \sigma'\equiv\bar{\sigma'}$.

  }

\case{$t=t_1\And t_2$}
  {One rule applies, namely \userule{Sym-S-And}.
  Provided that $M\phi_1\land M\phi_2$ and \userule{S-And} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t_1'\And t_2'\equiv \bar{t_1'}\And\bar{t_2'} \land M\sigma''\equiv \bar{\sigma''}$.

  From the induction hypothesis, we obtain the following.
  $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$. And \\
  $\forall M_2 . M_2 \phi_2 \land t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\implies M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

  Since $M$ satisfies both $\phi_1$ and $\phi_2$, and $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
  we know that $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

  }

\end{proof}

\begin{lemma}[Soundness of normalisation]
  \label{lem:soundnorm}

  For all expressions $e$ and states $\sigma$,
  for all symolic normalisations $e,\sigma\normalise t,\sigma',\phi$,
  for all mappings $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $e,M \sigma \bar{\normalise}t',\sigma''$ and $\phi M =\True$,
  we have $t M \equiv t' \wedge \sigma' M \equiv \sigma''$.

\end{lemma}

\begin{proof}
  We prove Lemma~\ref{lem:soundnorm} by induction over $e$.

  The base case is when the Sym-N-Done rule applies.\\
  \userule{Sym-N-Done}\\

  Provided that $M\phi_1\land M\phi_2$ and \userule{N-Done} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t'\equiv \bar{t'}\land M\sigma''\equiv \bar{\sigma''}$.

  By Lemma~\ref{lem:soundeval} and Lemma~\ref{lem:soundstride},
  we know that
  $\forall M_1. M_1\phi_1 \land e,M_1\sigma \bar{eval}\bar{t},\bar{\sigma'}\implies M_1 t \equiv \bar{t} \land M_1 \sigma'\equiv \bar{\sigma'}$ and
  $\forall M_2.M_2\phi_2\land t,M_2\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}\implies M_2 t'\equiv\bar{t'}\land M_2\sigma''\equiv \bar{\sigma''}$.

  We assume $M$ to satisfy both $\phi_1$ and $\phi_2$ and we have $e,M\sigma \bar{eval}\bar{t},\bar{\sigma'}$ since $M\sigma\equiv \bar{\sigma}$.
  We also have $t,M\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}$,
  from wich we can directly conclude what we needed to prove,
  namely $M t'\equiv \bar{t'}\land M\sigma''\equiv \bar{\sigma''}$.

  The only induction step is when \userule{Sym-N-Repeat} applies.
  In this case, where we have that $M\phi_1\land M\phi_2 \land M\phi_3$ and \userule{N-Repeat} with $\bar{\sigma}=M\sigma$,
  we need to demonstrate that $M t''\equiv \bar{t''}\land M\sigma'''\equiv \bar{\sigma'''}$.

  Again by Lemma~\ref{lem:soundeval} and Lemma~\ref{lem:soundstride},
  we know that
  $\forall M_1. M_1\phi_1 \land e,M_1\sigma \bar{eval}\bar{t},\bar{\sigma'}\implies M_1 t \equiv \bar{t} \land M_1 \sigma'\equiv \bar{\sigma'}$ and
  $\forall M_2.M_2\phi_2\land t,M_2\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}\implies M_2 t'\equiv\bar{t'}\land M_2\sigma''\equiv \bar{\sigma''}$.
  Furthermore, we know by applying the induction hypothesis that $\forall M_3.M_3\phi_3 \land t',M_3\sigma''\bar{\normalise} \bar{t''},\bar{\sigma'''}\implies M_3 t''\equiv \bar{t''}\land M_3 \sigma'''\equiv \bar{\sigma'''}$.

  Since $M$ satisfies $\phi_1$, $\phi_2$ and $\phi_3$, and we have $e,M\sigma \bar{eval}\bar{t},\bar{\sigma'}$, since our premise contains $M\sigma = \bar{\sigma}$, we can conclude $M t \equiv \bar{t} \land M \sigma'\equiv \bar{\sigma'}$.
  This gives us that $t,M\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}$ and we can thus conclude that $M t'\equiv\bar{t'}\land M\sigma''\equiv \bar{\sigma''}$.
  This finally gives us $t',M\sigma''\bar{\normalise} \bar{t''},\bar{\sigma'''}$ from which we can conclude that which we needed to prove,
  namely $M t''\equiv \bar{t''}\land M\sigma'''\equiv \bar{\sigma'''}$.
\end{proof}

\begin{lemma}[Soundness of handling]
  \label{lem:soundhandle}

  For all tasks $t$ and states $\sigma$,
  for all symbolic executions $t,\sigma\handle{i} t',\sigma',\phi$,
  for all mappings $M = [s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,M \sigma \xrightarrow[]{M i} t'',\sigma''$ and $\phi M = \True$,
  we have $t'M \equiv t'' \wedge \sigma' M \equiv \sigma''$
\end{lemma}

\begin{proof}
  We prove Lemma~\ref{lem:soundhandle} by induction over $t$.\\

  \case{$t=\Edit v$}
    {One rule applies, namely \userule{Sym-H-Change}.
    Provided that $M\True$ and \userule{H-Change} with $\bar{\sigma}=M\sigma$ and $M s = v'$,
    we need to demonstrate that $M \Edit s\equiv \Edit v'$ and $ M\sigma\equiv \bar{\sigma}$.

    Both follow trivially from the premise.

    }

  \case{$t=\Enter \tau$}
  {One rule applies, namely \userule{Sym-H-Fill}.
  Provided that $M\True$ and \userule{H-Fill} with $\bar{\sigma}=M\sigma$ and $M s = v$,
  we need to demonstrate that $M \Edit s \equiv \Edit v$ and $ M\sigma\equiv \bar{\sigma}$.

  Both follow trivially from the premise.

  }

  \case{$t=\Update l$}
  {One rule applies, namely \userule{Sym-H-Update}.
  Provided that $M\True$ and \userule{H-Update} with $\bar{\sigma}=M\sigma$ and $M s = v$,
  we need to demonstrate that $M \Update l \equiv \Update l$ and $ M\sigma[l\mapsto s]\equiv \bar{\sigma}[l\mapsto v]$.

  The first follows trivially, since locations cannot contain symbols. The second proof obligation can be concluded from the fact that $\bar{\sigma}=M\sigma$ and $M s = v$.

  }

  \case{$t=t_1\Next e_2$}
  {In this case, two rules apply.\\
    \case{\userule{Sym-H-Next}}
      {

      }
    \case{\userule{Sym-H-PassNext}}{}
  }

  \case{$t=t_1\Then e_2$}
  {

  }

  \case{$t=e_1\Xor e_2$}
  {
  In this case, two rules apply.\\
    \case{\userule{Sym-H-PickLeft}}{}
    \case{\userule{Sym-H-PickRight}}{}
  }

  \case{$t=e_1\And e_2$}
  {
  In this case, two rules apply.\\
    \case{\userule{Sym-H-FirstAnd}}{}
    \case{\userule{Sym-H-SecondAnd}}{}
  }

  \case{$t=e_1\Or e_2$}
  {
  In this case, two rules apply.\\
    \case{\userule{Sym-H-FirstOr}}{}
    \case{\userule{Sym-H-SecondOr}}{}
  }
\end{proof}

\begin{lemma}[Soundness of driving]
  \label{lem:sounddrive}

  For all tasks $t$ and states $\sigma$,
  for all symbolic executions $t,\sigma\drive{i} t',\sigma',\phi$
  for all mappings $M=[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$
  such that $t,\sigma M \xRightarrow[]{i} t'',\sigma''$ and $\phi M = \True$,
  we have $t'M \equiv t'' \wedge \sigma' M \equiv \sigma''$.
\end{lemma}


\begin{theorem}[Completeness of symbolic execution]
For all tasks $t$ and input lists $[j_0,\cdots,j_n]$ such that $\mathit{eval}\ t\ [j_0,\cdots,j_n]\ \emptyset = (t',\sigma')$,
then there exists an element $(t'',I,\sigma'',\phi'')\in \mathit{drive}\ t\ [\ ]\ \emptyset\ \True$ and mapping $[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$ such that
$I[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]=[j_0,\cdots,j_n]$ and $t'=t''[s_0\mapsto c_0,\cdots,s_n\mapsto c_n]$.
  \label{thm:complete}
\end{theorem}


\begin{lemma}[Completeness of evaluation]
  $\forall e,\sigma$ such that $t,\sigma \bar{\eval}v,\sigma'$
  there exists a symbolic execution $t,\sigma''\eval v',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\eval v,\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of striding]
  $\forall t,\sigma$ such that $t,\sigma \bar{\stride}t',\sigma'$
  there exists a symbolic execution $t,\sigma''\eval t'',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\stride t',\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of normalisation]
  $\forall e,\sigma$ such that $e,\sigma \bar{\normalise}t',\sigma'$
  there exists a symbolic execution $t,\sigma''\normalise t'',\sigma''',\phi$.
\end{lemma}

This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\normalise t',\sigma',\True$. In other words; every concrete evaluation is also a valid symbolic execution.

\begin{lemma}[Completeness of handling]
  $\forall t,\sigma,j$ such that $t,\sigma \xrightarrow[]{j} t'',\sigma''$
  there exists an $i$ such that $t,\sigma''\handle{i} t'',\sigma''',\phi$. And when substituting the symbol from $i$ with the concrete value from $j$, denoted by $s\mapsto c$, we get $\phi[s\mapsto c]\equiv\True$, $t''[s\mapsto c]\equiv t']$ and $\sigma'''[s\mapsto c]\equiv\sigma'']$.
\end{lemma}

\begin{lemma}[Completeness of driving]
\end{lemma}
