% !TEX root=../../main.tex


\begin{proof}[Proof of Theorem~\ref{thm:sound}]
    \fixme{todo!}
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:soundeval}]
  We prove Lemma~\ref{lem:soundeval} by induction over $e$.

\case{$e=v$}
  {One rule applies, namely \userule{Sym-E-Value}
  Since this rule does not generate constraints, any $M$ will do.
  Since neither the state, nor the expression is altered by the evaluation rule \userule{E-Value},
  this case holds true trivially.
  }

\case{$e=\tuple{e_1,e_2}$}
  {One rule applies, namely \userule{Sym-E-Pair}\\
  Provided that $M\phi_1\wedge M\phi_2$,
  we need to demonstrate that  \userule{E-Pair} with $\bar{\sigma}=M\sigma$,
  $M\tuple{v_1,v_2} \equiv \tuple{\bar{v_1},\bar{v_2}}$ and $M\sigma''\equiv\bar{\sigma''}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi_1 \implies e_1, M_1\sigma \bar{\eval}\bar{v_1},\bar{\sigma'}\land  M_1v_1\equiv \bar{v_1} \land  M_1\sigma'\equiv\bar{\sigma'}$ and
  $\forall M_2 . M_2\phi_2 \implies e_2,M_2\sigma' \bar{\eval}\bar{v_2},\bar{\sigma''}\land M_2v_2\equiv \bar{v_2} \wedge M_2\sigma'\equiv\bar{\sigma''}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$,
  and we know that $M\sigma'\equiv \bar{\sigma'}$
  we obtain that $e_1,M\sigma \bar{\eval}\bar{v_1},\bar{\sigma'}$,
  $e_2,M\sigma'\bar{\eval}\bar{v_2},\bar{\sigma''}$, $M\sigma'\equiv \bar{\sigma'}$,
 $M v_1\equiv \bar{v_1}$ and $M v_2 \equiv \bar{v_2}$ and therefore $M\tuple{v_1,v_2} \equiv \tuple{\bar{v_1},\bar{v_2}}$.
  From the IH we directly obtain that $M \sigma'' \equiv\bar{\sigma''}$.
  }

\case{$e=e_1 e_2$}
  {One rule applies, namely \userule{Sym-E-App}\\
  Provided that $M\phi_1 \land M\phi_2\land M\phi_3$,
  we need to demonstrate that
  \userule{E-App} with $\bar{\sigma}=M\sigma$,
   $M v_1 \equiv \bar{v_1}$ and $M\sigma'''\equiv\bar{\sigma'''}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 . M_1\phi_1 \implies e_1,M_1\sigma\bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}
  \land M_1\lambda x : \tau.e_1' \equiv \lambda x : \tau.\bar{e_1'} \land M_1\sigma'\equiv\bar{\sigma'}$
  and\\
  $\forall M_2 . M_2\phi_2 \implies e_2,M_2\sigma'\bar{\eval}\bar{v_2},\bar{\sigma''}
  \land M_2 v_2 \equiv \bar{v_2} \land M_2\sigma'' \equiv\bar{\sigma''}$
  and\\
  $\forall M_3 . M_3\phi_3 \implies \bar{e_1'}[x\mapsto \bar{v_2}],M_3\sigma''\bar{\eval}\bar{v_1},\bar{\sigma'''}
  \land M_3 v_1\equiv \bar{v_1} \land M_3 \sigma'''\equiv\bar{\sigma'''}$.

  Since $M$ satisfies both $\phi_1$, $\phi_2$ and $\phi_3$, and we know that
  $M\sigma' \equiv\bar{\sigma'}$ and $M\sigma'' \equiv\bar{\sigma''}$,
  we obtain that $e_1,M\sigma \bar{\eval}\lambda x : \tau.\bar{e_1'},\bar{\sigma'}$, $e_2,M\sigma' \bar{\eval}\bar{v_2},\bar{\sigma''}$ and $\bar{e_1'}[x\mapsto \bar{v_2}],M\sigma'' \bar{\eval}\bar{v_1},\bar{\sigma'''}$.
  We can then directly conclude that $M v_1 \equiv \bar{v_1}$ and $M\sigma'''\equiv\bar{\sigma'''}$.
  }

\case{$e=\If{e_1}{e_2}{e_3}$}
   {\fixme{Correct this case}


  % Two rules apply to this case.\\
  % \case{\userule{Sym-E-IfTrue}}
  %   {Provided that $M\phi_1 \land M\phi_2 \land M v_1 M$, and\\
  %   \userule{E-IfTrue} with $\bar{\sigma}=M \sigma$,
  %   we need to demonstrate that $M v_2 \equiv \bar{v_2}$ and $M \sigma''\equiv\bar{\sigma''}$.
  %
  %   From the induction hypothesis, we obtain the following.\\
  %   $\forall M_1 .M_1 \phi_1 \land M_1 v_1 \land e_1,M_1 \sigma \bar{\eval}\True,\bar{\sigma'}\implies M_1 v_1 \equiv \True \land M_1\sigma' \equiv\bar{\sigma'}$ and\\
  %   $\forall M_2 . M_2 \phi_2 \wedge e_2,M_2 \sigma' \bar{\eval}\bar{v_2},\bar{\sigma''}\implies M_2 v_2\equiv \bar{v_2} \land M_2\sigma''\equiv\bar{\sigma''}$
  %
  %   Since $M$ satisfies both $\phi_1$, $v_1$ and $\phi_2$,
  %   and we know from the premise that $e_1,M\sigma \bar{\eval}\True,\bar{\sigma'}$,
  %   and $e_2,M\sigma' \bar{\eval}\bar{v_2},\bar{\sigma''}$ since $M\sigma' \equiv \bar{\sigma}$,
  %   we obtain that $M v_2 \equiv \bar{v_2}$ and $M \sigma'' \equiv\bar{\sigma''}$.
  %
  %   }
  % \case{\userule{Sym-E-IfFalse}}
  %   {Provided that $M\phi_1 \land M\phi_2 \land \lnot M v_1 M$, and\\
  %   \userule{E-IfFalse} with $\bar{\sigma}=M \sigma$,
  %   we need to demonstrate that $M v_2 \equiv \bar{v_2}$ and $M \sigma''\equiv\bar{\sigma''}$.
  %
  %   From the induction hypothesis, we obtain the following.\\
  %   $\forall M_1 .M_1 \phi_1 \land\lnot M_1 v_1 \land e_1,M_1 \sigma \bar{\eval}\False,\bar{\sigma'}\implies M_1 v_1 \equiv \False \land M_1\sigma' \equiv\bar{\sigma'}$ and\\
  %   $\forall M_2 . M_2 \phi_2 \wedge e_3,M_2 \sigma \bar{\eval'}\bar{v_3},\bar{\sigma''}\implies M_2 v_3\equiv \bar{v_3} \land M_2\sigma''\equiv\bar{\sigma''}$
  %
  %   Since $M$ satisfies both $\phi_1$, $\lnot v_1$ and $\phi_2$,
  %   and we know from the premise that $e_1,M\sigma \bar{\eval}\False,\bar{\sigma}$,
  %   and $e_3,M\sigma' \bar{\eval}\bar{v_3},\bar{\sigma'}$ since $M\sigma' \equiv \bar{\sigma'}$,
  %   we obtain that $M v_3 \equiv \bar{v_3}$ and $M \sigma'' \equiv\bar{\sigma''}$.
  %
  %   }
  }

\case{$e=\Ref e$}
  {One rule applies, namely \userule{Sym-E-Ref}\\
  Provided that $M\phi$,
  we need to demonstrate that \userule{E-Ref} with $\bar{\sigma}=M\sigma$,
  $M l \equiv l$ and $M\sigma'[l\mapsto v]\equiv\bar{\sigma'}[l\mapsto\bar{v}]$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}\bar{v},\bar{\sigma'}\land  M_1v\equiv \bar{v} \wedge  M_1\sigma'\equiv\bar{\sigma'}$.

  We assume that the assignment of location references happens in a deterministic manner, and that we can therefore conclude that exactly the same $l$ is used in both cases. Since $l$ cannot contain any symbols, $M l \equiv l$ holds trivially.

  Since $M$ satisfies $\phi$,
  we obtain that $e,M\sigma \bar{\eval}\bar{v},\bar{\sigma'}$ and $M v\equiv \bar{v}$.
  This, together with $M \sigma' \equiv\bar{\sigma'}$ obtained from the induction hypothesis, we can conclude that $M\sigma'[l\mapsto v]\equiv\bar{\sigma'}[l\mapsto\bar{v}]$.
  }

\case{$e=!e$}
  {One rule applies, namely \userule{Sym-E-Deref}\\
  Provided that $M\phi$, we need to demonstrate that \userule{E-Deref} with $\bar{\sigma}=M\sigma$,
  $M \sigma'(l) \equiv \bar{\sigma'}(l)$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}l,\bar{\sigma'}\land  M_1l\equiv l \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Note that since $l$ cannot contain any symbols, $M l \equiv l$ holds trivially.

  Since $M$ satisfies $\phi$,
  we immediately obtain $e,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  and $M\sigma'\equiv\bar{\sigma'}$.
}

\case{$e=e_1:=e_2$}
  {
  One rule applies, namely \userule{Sym-E-Assign}\\
  Provided that $M\phi_1\wedge M\phi_2$,
  we need to demonstrate that \userule{E-Assign} with $\bar{\sigma}=M\sigma$,
  $M\unit \equiv \unit$, which holds true trivially,
  and $M\sigma''[l\mapsto v_2]\equiv\bar{\sigma''}[l\mapsto\bar{v_2}]$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi_1 \implies e_1, M_1\sigma \bar{\eval}l,\bar{\sigma'}\land  M_1 l\equiv l \land  M_1\sigma'\equiv\bar{\sigma'}$ and\\
  $\forall M_2 . M_2\phi_2 \implies e_2,M_2\sigma' \bar{\eval}\bar{v_2},\bar{\sigma''}\land M_2v_2\equiv \bar{v_2} \land M_2\sigma'\equiv\bar{\sigma''}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$, and we know that $M\sigma'\equiv \bar{\sigma'}$,
  we obtain that $e_1,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  $e_2,M\sigma'\bar{\eval}\bar{v_2},\bar{\sigma''}$,
  $M l\equiv l$, $M v_2 \equiv \bar{v_2}$ and $M\sigma''\equiv\bar{\sigma''}$ and therefore $M\sigma''[l\mapsto v_2]\equiv\bar{\sigma''}[l\mapsto\bar{v_2}]$.
  }

\case{$e=\Edit e$}
  {One rule applies, namely \userule{Sym-E-Edit}\\
  Provided that $M\phi$,
  we need to demonstrate that \userule{E-Edit} with $\bar{\sigma}=M\sigma$,
  $M \Edit v \equiv \Edit \bar{v}$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}\bar{v},\bar{\sigma'}\land  M_1v\equiv \bar{v} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  we obtain that $e,M\sigma \bar{\eval}\bar{v},\bar{\sigma'}$,
  $M \Edit v\equiv \Edit \bar{v}$.
  We can furthermore directly conclude that $\sigma' M\equiv\bar{\sigma'}$.

  }

\case{$e=\Enter \tau$}
  {
  One rule applies, namely \userule{Sym-E-Enter}\\
  Provided that $M\phi$, we need to demonstrate that \userule{E-Enter} with $\bar{\sigma}=M\sigma$,
  $M \Enter \tau \equiv \Enter \tau$, which holds trivially since types do not hold symbols,
  and $M\sigma\equiv\bar{\sigma}$, which also hols trivially from the premise.
  }

\case{$e=\Update e$}
  {One rule applies, namely \userule{Sym-E-Update}\\
  Provided that $M\phi$, we need to demonstrate that \userule{E-Update} with $\bar{\sigma}=M\sigma$,
  $M \Update l \equiv \Update l$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}l,\bar{\sigma'}\land  M_1 l\equiv l \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  we obtain that $e,M\sigma \bar{\eval}l,\bar{\sigma'}$,
  and $M \Update l\equiv \Update l$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Then e_2$}
  {One rule applies, namely \userule{Sym-E-Then}\\
  Provided that $M\phi$, we need to demonstrate that \userule{E-Then} with $\bar{\sigma}=M\sigma$,
  $M t_1\Then e_2 \equiv \bar{t_1}\Then e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\and  M_1 t_1\equiv \bar{t_1} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  we obtain that $e,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$
  and $M t_1\Then e_2 \equiv \bar{t_1}\Then e_2$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Next e_2$}
  {One rule applies, namely \userule{Sym-E-Next}\\
  Provided that $M\phi$, we need to demonstrate that \userule{E-Next} with $\bar{\sigma}=M\sigma$,
  $M t_1\Next e_2 \equiv \bar{t_1}\Then e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi \implies e, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\land  M_1 t_1\equiv \bar{t_1} \land  M_1\sigma'\equiv\bar{\sigma'}$.

  Since $M$ satisfies $\phi$,
  we obtain that $e,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$
  and $M t_1\Next e_2 \equiv \bar{t_1}\Next e_2$.
  We can furthermore directly conclude that $M \sigma' \equiv\bar{\sigma'}$.

  }

\case{$e=e_1\Or e_2$}
  {One rule applies, namely \userule{Sym-E-Or}\\
  Provided that $M\phi_1\wedge M\phi_2$, we need to demonstrate that \userule{E-Or} with $\bar{\sigma}=M\sigma$, $M t_1\Or t_2 \equiv \bar{t_1}\Or\bar{t_2}$ and $M\sigma''\equiv\bar{\sigma''}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 .  M_1\phi_1 \implies e_1, M_1\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\land  M_1 t_1\equiv \bar{t_1} \land  M_1\sigma'\equiv\bar{\sigma'}$ and\\
  $\forall M_2 . M_2\phi_2 \implies e_2,M_2\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}\land M_2t_2\equiv \bar{t_2} \land M_2\sigma'\equiv\bar{\sigma'}$

  Since $M$ satisfies both $\phi_1$ and $\phi_2$, and we know that $M\sigma'\equiv \bar{\sigma'}$,
  we obtain that $e_1,M\sigma \bar{\eval}\bar{t_1},\bar{\sigma'}$,
  $e_2,M\sigma'\bar{\eval}\bar{t_2},\bar{\sigma}$, $M t_1\equiv \bar{t_1}$ and $M t_2 \equiv \bar{t_2}$ and therefore $M t_1\Or t_2 \equiv \bar{t_1}\Or\bar{t_2}$.
  From the IH we directly obtain that $M \sigma'' \equiv\bar{\sigma''}$.

  }

\case{$e=e_1\Xor e_2$}
  {  One rule applies, namely \userule{Sym-E-Xor}\\
    Provided that $M\phi$, we need to demonstrate that \userule{E-Xor} with $\bar{\sigma}=M\sigma$,
    $M e_1\Xor e_2 \equiv \bar{e_1}\Xor\bar{e_2}$,
    which holds trivially,
    and $M\sigma\equiv\bar{\sigma}$, which also holds trivially from the premise.

  }

\case{$e=\Fail$}
  {  One rule applies, namely \userule{Sym-E-Fail}\\
    Provided that $M\phi$, we need to demonstrate that \userule{E-Fail} with $\bar{\sigma}=M\sigma$,
    $M \Fail \equiv \Fail$, which holds trivially since fail do not hold symbols,
    and $M\sigma\equiv\bar{\sigma}$, which also hols trivially from the premise.

  }
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:soundstride}]
  We prove Lemma~\ref{lem:soundstride} by induction over $t$.

\case{$t=t_1\Then e_2$}
  {
  Three rules apply.\\
  \case{\userule{Sym-S-ThenStay}}
    {Provided that $M\phi\equiv\True$
    we need to demonstrate that
    \userule{S-ThenStay} with $\bar{\sigma}=M\sigma$,
    $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2 $ and $ M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$,
    we know that
    $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$
    and $M t_1'\equiv\bar{t_1'}$,
    and therefore also $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2$,
    and from the induction hypothesis, we directly obtain  $M\sigma'\equiv \bar{\sigma'}$.
    }
  \case{\userule{Sym-S-ThenFail}}
    {Provided that $M\phi\equiv\True$
    we need to demonstrate that
    \userule{S-ThenFail} with $\bar{\sigma}=M\sigma$,
    $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2$ and $M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$,
    we know that
    $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$
    and $M t_1'\equiv\bar{t_1'}$,
    and therefore also $M t_1'\Then e_2 \equiv \bar{t_1'}\Then e_2$,
    and from the induction hypothesis, we directly obtain  $M\sigma'\equiv \bar{\sigma'}$.
    }
  \case{\userule{Sym-S-ThenCont}}
    {Provided that $M\phi_1\land M\phi_2$
    we need to demonstrate that
    \userule{S-ThenCont} with $\bar{\sigma}=M\sigma$,
    $M t_2 \equiv \bar{t_2}\Then e_2$ and $M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.\\
    From Lemma~\ref{lem:soundeval} we know that\\
    $\forall M_2 . M_2 \phi_2 \implies e_2\bar{v_1}M_2\sigma'\bar{\eval}\bar{t_2},\bar{\sigma''}\and M_2 t_2\equiv \bar{t_2}\land M_2\sigma''\equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$,
    we know that
    $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $e_2\bar{v_1}M\sigma'\bar{\eval}\bar{t_2},\bar{\sigma''}$,
    $M t_2\equiv\bar{t_2}$,
    and from the induction hypothesis, we directly obtain  $M\sigma''\equiv \bar{\sigma''}$.

    }
  }

\case{$t=t_1\Or t_2$}
  {
  Three rules apply.\\
  \case{\userule{Sym-S-OrLeft}}
    {Provided that $M\phi\equiv\True$
    we need to demonstrate that
    \userule{S-OrLeft} with $\bar{\sigma}=M\sigma$,
    $M t_1'\equiv \bar{t_1'}$ and $M\sigma'\equiv \bar{\sigma'}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\and M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

    Since $M$ satisfies $\phi$, we know that $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
    $M t_1'\equiv\bar{t_1'}$ and $M\sigma'\equiv \bar{\sigma'}$.

    }
  \case{\userule{Sym-S-OrRight}}
    {Provided that $M\phi_1\land M\phi_2$
    we need to deomstrate that
    \userule{S-OrRight} with $\bar{\sigma}=M\sigma$,
    $M t_2'\equiv \bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$ and\\
    $\forall M_2 . M_2 \phi_2 \implies t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\land M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$,
    we know that
    $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
    $M t_2'\equiv\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    }
  \case{\userule{Sym-S-OrNone}}
    {Provided that $M\phi_1\land M\phi_2$
    we need to demonstrate that
    \userule{S-OrNone} with $\bar{\sigma}=M\sigma$,
    $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    From the induction hypothesis, we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$ and\\
    $\forall M_2 . M_2 \phi_2 \implies t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\land M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

    Since $M$ satisfies both $\phi_1$ and $\phi_2$,
    we know that $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
    $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

    }
  }

\case{$t=\Edit v$}
  {One rule applies, namely \userule{Sym-S-Edit}\\
  Provided that $M\True$, we need to demonstrate that \userule{S-Edit} with $\bar{\sigma}=M\sigma$,
  $M\Edit v \equiv \Edit \bar{v}$ and $M\sigma \equiv \bar{\sigma}$.
  This holds trivially.

  }

\case{$t=\Enter \tau$}
  {One rule applies, namely \userule{Sym-S-Fill}\\
  Provided that $M\True$, we need to demonstrate \userule{S-Fill} with $\bar{\sigma}=M\sigma$,
  $M\Enter \tau \equiv \Enter \tau$ and $M\sigma \equiv \bar{\sigma}$.
  This holds trivially.
  }

\case{$t=\Update l$}
  {One rule applies, namely \userule{Sym-S-Update}\\
  Provided that $M\True$, we need to demonstrate \userule{S-Update} with $\bar{\sigma}=M\sigma$,
  $M\Update l \equiv \Update l$ and $M\sigma \equiv \bar{\sigma}$.
  This holds trivially.
  }

\case{$t=\Fail$}
  {One rule applies, namely \userule{Sym-S-Fail}\\
  Provided that $M\True$, we need to demonstrate that \userule{S-Fail} with $\bar{\sigma}=M\sigma$,
  $M\Fail \equiv \Fail$ and $M\sigma \equiv \bar{\sigma}$.
  This holds trivially.
  }

\case{$t=e_1\Xor e_2$}
  {One rule applies, namely \userule{Sym-S-Xor}\\
  Provided that $M\True$, we need to demonstrate that \userule{S-Xor} with $\bar{\sigma}=M\sigma$,
  $M e_1\Xor e_2 \equiv e_1\Xor e_2$ and $M\sigma \equiv \bar{\sigma}$.
  This holds trivially.
  }

\case{$t=t_1\Next e_2$}
  {One rule applies, namely \userule{Sym-S-Next}\\
  Provided that $M\phi$,
  we need to demonstrate that \userule{S-Xor} with $\bar{\sigma}=M\sigma$,
  $M t_1'\Next e_2\equiv \bar{t_1'}\Next e_2$ and $M \sigma'\equiv\bar{\sigma'}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 . M_1 \phi \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\land M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$.

  Since $M$ satisfies $\phi$, we directly obtain $t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$,
  $M t_1'\Next e_2\equiv \bar{t_1'}\Next e_2$ and $M \sigma'\equiv\bar{\sigma'}$.

  }

\case{$t=t_1\And t_2$}
  {One rule applies, namely \userule{Sym-S-And}\\
  Provided that $M\phi_1\land M\phi_2$
  we need to demonstrate $\userule{S-And}$ with $\bar{\sigma}=M\sigma$,
  $M t_1'\And t_2'\equiv \bar{t_1'}\And\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

  From the induction hypothesis, we obtain the following.\\
  $\forall M_1 . M_1 \phi_1 \implies t_1,M_1\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}\and M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$ and\\
  $\forall M_2 . M_2 \phi_2 \implies t_2,M_2\sigma' \bar{\stride} \bar{t_2'},\bar{\sigma''}\and M_2 t_2'\equiv\bar{t_2'}\land M_2\sigma'' \equiv \bar{\sigma''}$.

  Since $M$ satisfies both $\phi_1$ and $\phi_2$,
  we know that $t_1,M\sigma \bar{\stride} \bar{t_1'},\bar{\sigma'}$ and $t_2,M\sigma'\bar{\stride}\bar{t_2'},\bar{\sigma''}$,
  $M t_1'\Or t_2'\equiv \bar{t_1'}\Or\bar{t_2'}$ and $M\sigma''\equiv \bar{\sigma''}$.

  }

\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:soundnorm}]
  We prove Lemma~\ref{lem:soundnorm} by induction over $e$.

  The base case is when the Sym-N-Done rule applies.\\
  \userule{Sym-N-Done}\\

  Provided that $M\phi_1\land M\phi_2$\\
  we need to demonstrate that
  \userule{N-Done} with $\bar{\sigma}=M\sigma$,
  $M t'\equiv \bar{t'}$ and $M\sigma''\equiv \bar{\sigma''}$.

  By Lemma~\ref{lem:soundeval} and Lemma~\ref{lem:soundstride}, we know that\\
  $\forall M_1. M_1\phi_1 \implies e,M_1\sigma \bar{eval}\bar{t},\bar{\sigma'}\land M_1 t \equiv \bar{t} \land M_1 \sigma'\equiv \bar{\sigma'}$ and\\
  $\forall M_2.M_2\phi_2\implies t,M_2\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}\land M_2 t'\equiv\bar{t'}\land M_2\sigma''\equiv \bar{\sigma''}$.

  We assume $M$ to satisfy both $\phi_1$ and $\phi_2$, we have $e,M\sigma \bar{\eval}\bar{t},\bar{\sigma'}$ since $M\sigma\equiv \bar{\sigma}$.
  We also have $t,M\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}$,
  from wich we can directly conclude what we needed to prove,
  namely $M t'\equiv \bar{t'}\land M\sigma''\equiv \bar{\sigma''}$.

  The only induction step is when\\
  \userule{Sym-N-Repeat} applies.
  In this case, where we have that $M\phi_1\land M\phi_2 \land M\phi_3$,
  we need to demonstrate that
  \userule{N-Repeat} with $\bar{\sigma}=M\sigma$,
  $M t''\equiv \bar{t''}$ and $M\sigma'''\equiv \bar{\sigma'''}$.

  Again by Lemma~\ref{lem:soundeval} and Lemma~\ref{lem:soundstride}, we know that\\
  $\forall M_1. M_1\phi_1 \implies e,M_1\sigma \bar{eval}\bar{t},\bar{\sigma'}\land M_1 t \equiv \bar{t} \land M_1 \sigma'\equiv \bar{\sigma'}$ and\\
  $\forall M_2.M_2\phi_2\implies t,M_2\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}\land M_2 t'\equiv\bar{t'}\land M_2\sigma''\equiv \bar{\sigma''}$.\\
  Furthermore, we know by applying the induction hypothesis that $\forall M_3.M_3\phi_3 \implies t',M_3\sigma''\bar{\normalise} \bar{t''},\bar{\sigma'''}\land M_3 t''\equiv \bar{t''}\land M_3 \sigma'''\equiv \bar{\sigma'''}$.

  Since $M$ satisfies $\phi_1$, $\phi_2$ and $\phi_3$,
  we can conclude that

  $e,M\sigma \bar{\eval}\bar{t},\bar{\sigma'}$, $M t \equiv \bar{t} \land M \sigma'\equiv \bar{\sigma'}$ and $t,M\sigma'\bar{\stride}\bar{t'},\bar{\sigma''}$ and $M t'\equiv\bar{t'}\land M\sigma''\equiv \bar{\sigma''}$.
  This finally gives us $t',M\sigma''\bar{\normalise} \bar{t''},\bar{\sigma'''}$ from which we can conclude that which we needed to prove,
  namely $M t''\equiv \bar{t''}\land M\sigma'''\equiv \bar{\sigma'''}$.
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:soundhandle}]
  We prove Lemma~\ref{lem:soundhandle} by induction over $t$.\\

  \case{$t=\Edit v$}
    {One rule applies, namely \userule{Sym-H-Change}\\
    Provided that $M\True$ we need to demonstrate that \userule{H-Change} with $\bar{\sigma}=M\sigma$ and $M s = v'$,
    $M \Edit s\equiv \Edit v'$ and $ M\sigma\equiv \bar{\sigma}$.

    This follows trivially from the premise.

    }

  \case{$t=\Enter \tau$}
  {One rule applies, namely \userule{Sym-H-Fill}\\
  Provided that $M\True$ we need to demonstrate that \userule{H-Fill} with $\bar{\sigma}=M\sigma$ and $M s = v$,
  $M \Edit s \equiv \Edit v$ and $ M\sigma\equiv \bar{\sigma}$.

  This follows trivially from the premise.

  }

  \case{$t=\Update l$}
  {One rule applies, namely \userule{Sym-H-Update}\\
  Provided that $M\True$
  we need to demonstrate that  \userule{H-Update} with $\bar{\sigma}=M\sigma$ and $M s = v$,
  $M \Update l \equiv \Update l$ and $ M\sigma[l\mapsto s]\equiv \bar{\sigma}[l\mapsto v]$.

  \userule{H-Update} with $\bar{\sigma}=M\sigma$ follows trivially.
  $M \Update l \equiv \Update l$ follows trivially, since locations cannot contain symbols. $ M\sigma[l\mapsto s]\equiv \bar{\sigma}[l\mapsto v]$ can be concluded from the fact that $\bar{\sigma}=M\sigma$ and $M s = v$.

  }

  \case{$t=t_1\Next e_2$}
  {\fixme{correct these cases to deal with the new rules}
  In this case, two rules apply.\\
    \case{\userule{Sym-H-Next}}
      {Provided that $M\phi$ and \userule{H-Next} with $\bar{\sigma}=M\sigma$,
      we need to demonstrate that $M t_2 \equiv \bar{t_2}$ and $M\sigma'\equiv\bar{\sigma'}$.

      From Lemma~\ref{lem:soundnorm} we obtain that $\forall M_1. M_1 \phi \land e_2 v_1,M\sigma\bar{normalise}\bar{t_2},\bar{\sigma'}\implies M t_2\equiv\bar{t_2}\land M \sigma'\equiv\bar{\sigma'}$.

      This gives us exactly what we needed to prove this case.

      }
    \case{\userule{Sym-H-PassNext}}
    {Provided that $M\phi$ and \userule{H-PassNext} with $\bar{\sigma}=M\sigma$ and $j= M i$,
    we need to demonstrate that $M t_1' \Next e_2 \equiv \bar{t_1'}\Next e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

    By the induction hypothesis we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$

    Since $M$ satisfies $\phi$, and $t_1,M\sigma \xrightarrow[]{M i} \bar{t_1'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
    which we needed to show, as well as $M t_1' \Next e_2 \equiv \bar{t_1'}\Next e_2$ since this can be concluded from $M t_1'\equiv \bar{t_1'}$.
    }
  }

  \case{$t=t_1\Then e_2$}
  {One rule applies, namely \userule{Sym-H-PassThen}\\
  Provided that $M\phi$ and \userule{H-PassThen} with $\bar{\sigma}=M\sigma$ and $j= M i$,
  we need to demonstrate that $M t_1'\Then e_2\equiv \bar{t_1'}\Then e_2$ and $M\sigma'\equiv\bar{\sigma'}$.

  By the induction hypothesis we obtain the following.\\
  $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$

  Since $M$ satisfies $\phi$, and $t_1,M\sigma \xrightarrow[]{M i} \bar{t_1'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
  which we needed to show, as well as $M t_1' \Then e_2 \equiv \bar{t_1'}\Then e_2$ since this can be concluded from $M t_1'\equiv \bar{t_1'}$.

  }

  \case{$t=e_1\Xor e_2$}
  {
  In this case, three rules apply.\\
    \case{\userule{Sym-H-Pick}}
    {
    \fixme{write this case}
    }
    \case{\userule{Sym-H-PickLeft}}
    {Provided that $M(\phi\wedge s=\Left)$ and \userule{H-PickLeft} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1\equiv \bar{t_1}$ and $M\sigma'\equiv \bar{\sigma'}$.

    From Lemma~\ref{lem:soundnorm} we obtain that $\forall M_1. M_1 \phi \land e_1,M\sigma\bar{\normalise}\bar{t_1},\bar{\sigma'}\implies M t_1\equiv\bar{t_1}\land M \sigma'\equiv\bar{\sigma'}$.

    Since $M$ satisfies $\phi$, and $e_1,M\sigma \bar{\normalise}[] \bar{t_1},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
    which we needed to show, as well as $M t_1 \equiv \bar{t_1}$.

    }
    \case{\userule{Sym-H-PickRight}}
    {Provided that $M(\phi\wedge s=\Right)$ and \userule{H-PickRight} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_2\equiv \bar{t_2}$ and $M\sigma'\equiv \bar{\sigma'}$.

    From Lemma~\ref{lem:soundnorm} we obtain that $\forall M_1. M_1 \phi \land e_2,M\sigma\bar{\normalise}\bar{t_2},\bar{\sigma'}\implies M t_2\equiv\bar{t_2}\land M \sigma'\equiv\bar{\sigma'}$.

    Since $M$ satisfies $\phi$, and $e_2,M\sigma \bar{\normalise}[] \bar{t_2},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
    which we needed to show, as well as $M t_2 \equiv \bar{t_2}$.
    }
  }

  \case{$t=t_1\And t_2$}
  {
  In this case, two rules apply.\\
    \case{\userule{Sym-H-FirstAnd}}
    {Provided that $M\phi$ and \userule{H-FirstAnd} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1'\And t_2\equiv \bar{t_1'}\And t_2$ and $M\sigma'\equiv \bar{\sigma'}$.

    By the induction hypothesis we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$

    Since $M$ satisfies $\phi$, and $t_1,M\sigma\xrightarrow[]{M i} \bar{t_1'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
    which we needed to show, as well as $M t_1'\And t_2\equiv \bar{t_1'}\And t_2$, which follows from $M t_1' \equiv \bar{t_1'}$.

    }
    \case{\userule{Sym-H-SecondAnd}}
    {Provided that $M\phi$ and \userule{H-SecondAnd} with $\bar{\sigma}=M\sigma$,
    we need to demonstrate that $M t_1\And t_2'\equiv t_1\And \bar{t_2}$ and $M\sigma'\equiv \bar{\sigma'}$.

    By the induction hypothesis we obtain the following.\\
    $\forall M_1 . M_1 \phi_1 \land t_2,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_2'},\bar{\sigma'}\implies M_1 t_2'\equiv\bar{t_2'}\land M_1\sigma' \equiv \bar{\sigma'}$

    Since $M$ satisfies $\phi$, and $t_2,M\sigma\xrightarrow[]{M i} \bar{t_2'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
    which we needed to show, as well as $M t_1\And t_2'\equiv t_1\And \bar{t_2'}$, which follows from $M t_2' \equiv \bar{t_2'}$.}
  }

  \case{$t=e_1\Or e_2$}
  {\fixme{write the new case here}
  % In this case, two rules apply.\\
  %   \case{\userule{Sym-H-FirstOr}}
  %   {Provided that $M\phi$ and \userule{H-FirstOr} with $\bar{\sigma}=M\sigma$,
  %   we need to demonstrate that $M t_1'\Or t_2\equiv \bar{t_1'}\And t_2$ and $M\sigma'\equiv \bar{\sigma'}$.
  %
  %   By the induction hypothesis we obtain the following.\\
  %   $\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_1'},\bar{\sigma'}\implies M_1 t_1'\equiv\bar{t_1'}\land M_1\sigma' \equiv \bar{\sigma'}$
  %
  %   Since $M$ satisfies $\phi$, and $t_1,M\sigma\xrightarrow[]{M i} \bar{t_1'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
  %   which we needed to show, as well as $M t_1'\Or t_2\equiv \bar{t_1'}\And t_2$, which follows from $M t_1' \equiv \bar{t_1'}$.
  %
  %   }
  %   \case{\userule{Sym-H-SecondOr}}
  %   {Provided that $M\phi$ and \userule{H-SecondOr} with $\bar{\sigma}=M\sigma$,
  %   we need to demonstrate that $M t_1\Or t_2'\equiv t_1\And \bar{t_2}$ and $M\sigma'\equiv \bar{\sigma'}$.
  %
  %   By the induction hypothesis we obtain the following.\\
  %   $\forall M_1 . M_1 \phi_1 \land t_2,M_1\sigma \xrightarrow[]{M_1 i} \bar{t_2'},\bar{\sigma'}\implies M_1 t_2'\equiv\bar{t_2'}\land M_1\sigma' \equiv \bar{\sigma'}$
  %
  %   Since $M$ satisfies $\phi$, and $t_2,M\sigma\xrightarrow[]{M i} \bar{t_2'},\bar{\sigma'}$ we have $M\sigma'\equiv\bar{\sigma'}$,
  %   which we needed to show, as well as $M t_1\Or t_2'\equiv t_1\And \bar{t_2'}$, which follows from $M t_2' \equiv \bar{t_2'}$.}

  }
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:sounddrive}]
  We prove Lemma~\ref{lem:sounddrive} as follows.
  There is only one rule that applies, namely \userule{Sym-I-Handle}.

  Provided that $M\phi_1\land\phi_2$ and \userule{I-Handle} with $\bar{\sigma}=M\sigma$ and $j=M i$,
  we need to demonstrate that $M t'' \equiv \bar{t''}$ and $M\sigma''\equiv \bar{\sigma''}$.


  Lemma~\ref{lem:soundhandle} and Lemma~\ref{lem:soundnorm} respectively give us that\\
$\forall M_1 . M_1 \phi_1 \land t_1,M_1\sigma \xrightarrow[]{M_1 i} \bar{t'},\bar{\sigma'}\implies M_1 t'\equiv\bar{t'}\land M_1\sigma' \equiv \bar{\sigma'}$ and \\
$\forall M_2 . M_2 \phi_2 \land t',M_2\sigma' \bar{\normalise} \bar{t''},\bar{\sigma''}\implies M_2 t''\equiv\bar{t''}\land M_2\sigma'' \equiv \bar{\sigma''}$.

Since $M$ satisfies both $\phi_1$ and $\phi_2$, and we have from the premise that
$t_1,M\sigma \xrightarrow[]{M i} \bar{t'},\bar{\sigma'}$ and
$t',M\sigma' \bar{\normalise} \bar{t''},\bar{\sigma''}$,
we obtain exactly what we needed to prove,
namely $M t'' \equiv \bar{t''}$ and $M\sigma''\equiv \bar{\sigma''}$.

\end{proof}
