% !TEX root=../../main.tex





%
% \begin{proof}[Proof of Theorem~\ref{thm:complete}]
%   \fixme{we cannot prove this, definition of drive function is incorrect}
% \end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:completeEval}]
This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\eval v,\sigma',\True$.
In other words; every concrete evaluation is also a valid symbolic execution.
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:completeStride}]
This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\stride t',\sigma',\True$.
In other words; every concrete evaluation is also a valid symbolic execution.
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:completeNormalise}]
This lemma holds trivially; assume $\sigma''=\sigma$, then we have $t,\sigma\normalise t',\sigma',\True$.
In other words; every concrete evaluation is also a valid symbolic execution.
\end{proof}



\begin{proof}[Proof of Lemma~\ref{lem:completeHandle}]

  We prove Lemma~\ref{lem:completeHandle} by induction over $t$.\\

  \case{$t=\Edit v$}
  {One rule applies in this case, namely \userule{H-Change}\\
  Take $i=s$ where s is a free symbol in $\sigma$ and assume $\sigma''=\sigma$.
  Then by the Sym-H-Change rule,
  we know that a symbolic execution exists.
  When applying the substitution $[s\mapsto v']$,
  we get $\Edit s[s\mapsto v'] = \Edit v'$ and $\sigma[s\mapsto v']=\sigma$ since $s$ is free in $\sigma$.

  }

  \case{$t=\Enter \tau$}
  {One rule applies in this case, namely \userule{H-Fill}\\
  Take $i=s$ where s is a free symbol in $\sigma$ and assume $\sigma''=\sigma$.
  Then by the Sym-H-Fill rule,
  we know that a symbolic execution exists.
  When applying the substitution $[s\mapsto v']$,
  we get $\Edit s[s\mapsto v'] = \Edit v'$ and $\sigma[s\mapsto v']=\sigma$ since $s$ is free in $\sigma$. }

  \case{$t=\Update l$}
  {One rule applies in this case, namely \userule{H-Update}\\
  Take $i=s$ where s is a free symbol in $\sigma$ and assume $\sigma''=\sigma$.
  Then by the Sym-H-Update rule,
  we know that a symbolic execution exists.
  When applying the substitution $[s\mapsto v']$,
  we get $\Edit s[s\mapsto v'] = \Edit v'$ and $\sigma[s\mapsto v']=\sigma$ since $s$ is free in $\sigma$. }

  \case{$t=t_1\Next e_2$}
  {Two rules apply in this case\\
    \case{\userule{H-Next}}
    {
    Take $i=s$ where s is a free symbol in $\sigma$ and $t$, and assume $\sigma''=\sigma$.
    Then by the Sym-H-Next rule,
    we know that a symbolic execution exists.
    When applying the substitution $[s\mapsto \Continue]$,
    we get $t_2[s\mapsto \Continue] = t_2'$ and $\sigma'[s\mapsto \Continue]=\sigma'$ since $s$ is free in both $\sigma$ and $t$.
    }
    \case{\userule{H-PassNext}}
    {
    By application of the induction hypothesis, we obtain the following.\\
    For all $t_1,\sigma,j$ such that $t_1,\sigma\xrightarrow[j]{}t_1',\sigma'$ there exists an $i$ such that $t_1'',\sigma''\handle{}t_1''',\sigma''',i,\phi$ and when substituting the symbol in $i$ for the concrete value from $j$, denoted by $[s\mapsto c]$, we have $t_1'''[s\mapsto c] = t_1'\land \sigma'''[s\mapsto c]=\sigma'$.\\
    From this we can conclude that there exists a symbolic execution $t_1\Next e_2,\sigma\handle{} t_1'''\Next e_2,\sigma''',i,\phi$, and that $t_1'''\Next e_2[s\mapsto c] = t_1'\Next e_2$ and $\sigma'''[s\mapsto c]=\sigma'$.
    }
  }


  \case{$t=t_1\Then e_2$}
  {
  One rule applies in this case, namely \userule{H-PassThen}\\

  By application of the induction hypothesis, we obtain the following.\\
  For all $t_1,\sigma,j$ such that $t_1,\sigma\xrightarrow[j]{}t_1',\sigma'$ there exists an $i$ such that $t_1'',\sigma''\handle{}t_1''',\sigma''',i,\phi$ and when substituting the symbol in $i$ for the concrete value from $j$, denoted by $[s\mapsto c]$, we have $t_1'''[s\mapsto c] = t_1'\land \sigma'''[s\mapsto c]=\sigma'$.\\
  From this we can conclude that there exists a symbolic execution $t_1\Then e_2,\sigma\handle{} t_1'''\Then e_2,\sigma''',i,\phi$, and that $t_1'''\Then e_2[s\mapsto c] = t_1'\Then e_2$ and $\sigma'''[s\mapsto c]=\sigma'$.
  }
  \case{$t=e_1\Xor e_2$}
  {
  Two rules apply in this case.\\
  \case{\userule{H-PickLeft}}
    {
      Take $i=s$ where s is free in $e_1$ and $\sigma$.\\
      Lemma~\ref{lem:completeNormalise} gives us that there exists a symbolic execution $e_1,\sigma\normalise t_1',\sigma'',\phi$.\\
      \fixme{now we need something like, failing, split in two cases, depending on right branch, etc etc}
    }
  \case{\userule{H-PickRight}}
    {
      \fixme{todo}
    }
  }
  \case{$t=t_1\Or t_2$}
    {
    Tow rules applies in this case.\\
    \case{\userule{H-FirstOr}}{\fixme{todo}}
    \case{\userule{H-SecondOr}}{\fixme{todo}}
    }
  \case{$t=t_1\And t_2$}
    {
    Tow rules applies in this case.\\
    \case{\userule{H-FirstAnd}}{\fixme{todo}}
    \case{\userule{H-SecondAnd}}{\fixme{todo}}
    }

\end{proof}



\begin{proof}[Proof of Theorem~\ref{thm:completeDrive}]
  The driving semantics only consists of one rule, namely \userule{I-Handle}.\\
  By Lemma~\ref{lem:completeHandle} we obtain the following.\\
  $t,\sigma\xrightarrow[j]{}\bar{t'},\bar{\sigma'}\implies \exists i . t,\sigma\handle{}t',\sigma',i,\phi \land t'[s\mapsto c]=\bar{t'}\land \sigma'[s\mapsto c]=\bar{\sigma'}$\\
  Then by Lemma~\ref{lem:completeNormalise} we obtain the following.\\
  $\bar{t'},\bar{\sigma'}\bar{\normalise}\bar{t''},\bar{\sigma''}\implies \bar{t'},\bar{\sigma'}\normalise t'',\sigma'',\phi'$\\
  From the above, together with the Sym-I-Handle rule, we can conclude that there exists a symbolic execution $t,\sigma\drive t',\sigma',i,\phi$.\\
  \fixme{how do we show that the resulting values are "compatible"?}
\end{proof}
